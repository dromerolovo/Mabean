<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:shadui="clr-namespace:ShadUI;assembly=ShadUI"
			 xmlns:vm="clr-namespace:Mabean.ViewModels"
			 xmlns:models="clr-namespace:Mabean.Models"
			 mc:Ignorable="d"
			 d:DesignWidth="800"
			 d:DesignHeight="450"
			 x:Class="Mabean.Views.EventsView"
			 x:DataType="vm:EventsViewModel"
			 VerticalAlignment="Stretch"
			 HorizontalAlignment="Stretch">

	<Border Padding="20">
		<Grid RowDefinitions="Auto,Auto,Auto,*,Auto,Auto">

			<TextBlock Grid.Row="0"
					   Classes="h4"
					   Text="Security Events" />

			<Border Grid.Row="1" Height="12"/>

			<Grid Grid.Row="2"
				  ColumnDefinitions="*,Auto"
				  Margin="0,0,0,16">
				<StackPanel Grid.Column="1"
							Orientation="Horizontal"
							Spacing="8">
					<Button Classes="Outline"
							Command="{Binding AnalyzeSelectedCommand}"
							Content="Analyze Selected"/>
					<Button Classes="Outline"
							Command="{Binding ClearEventsCommand}"
							Content="Clear Events"/>
				</StackPanel>
			</Grid>

			<Border Grid.Row="3"
					MaxHeight="420"
					ClipToBounds="True">

				<DataGrid
				Grid.Row="3"
				ItemsSource="{Binding SecurityEvents}"
				IsReadOnly="True"
				SelectionMode="Single"
				RowHeight="44"
				HeadersVisibility="Column"
				VerticalScrollBarVisibility="Auto"
				HorizontalScrollBarVisibility="Auto">

					<DataGrid.Columns>

						<DataGridTextColumn Width="100"
											Binding="{Binding RecordId}"
											Header="Record ID"/>

						<DataGridTemplateColumn Width="170"
												Header="Time Created"
												SortMemberPath="TimeCreated">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate DataType="models:SecurityEvent">
									<TextBlock Margin="12,0"
											   VerticalAlignment="Center"
											   Text="{Binding TimeCreated,
											   StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<DataGridTextColumn Width="80"
											Binding="{Binding EventId}"
											Header="Event ID"/>

						<DataGridTextColumn Width="200"
											Binding="{Binding Source}"
											Header="Source"/>

						<DataGridTextColumn Width="150"
											Binding="{Binding TaskCategory}"
											Header="Category"/>

						<DataGridTemplateColumn Width="*"
												CanUserSort="False"
												Header="Message">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate DataType="models:SecurityEvent">
									<TextBlock Margin="12,0"
											   VerticalAlignment="Center"
											   Text="{Binding Message}"
											   TextTrimming="CharacterEllipsis"
											   ToolTip.Tip="{Binding Message}"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<DataGridTemplateColumn Width="48"
												CanUserResize="False"
												CanUserSort="False">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate DataType="models:SecurityEvent">
									<CheckBox HorizontalAlignment="Center"
											  VerticalAlignment="Center"
											  IsChecked="{ReflectionBinding IsSelected}"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

					</DataGrid.Columns>
				</DataGrid>
			</Border>

			<TextBlock Grid.Row="4"
					   Margin="0,16,0,0"
					   Classes="Small Muted">
				<Run Text="{Binding SecurityEvents.Count}"/>
				<Run Text=" event(s) captured."/>
			</TextBlock>

			<StackPanel Grid.Row="5"
						Margin="0,20,0,0"
						Spacing="8">
				<TextBlock Classes="h4"
						   Text="Analysis"/>
				<StackPanel Orientation="Horizontal" Spacing="4">
					<TextBlock Classes="Small" FontWeight="Bold"
							   Text="Suspiciousness:"/>
					<TextBlock Classes="Small"
							   Text="{Binding Suspiciousness}"/>
				</StackPanel>
				<TextBlock Classes="Small" FontWeight="Bold"
						   Text="Explanation:"/>
				<TextBlock Classes="Small"
						   Text="{Binding Explanation}"
						   TextWrapping="Wrap"/>
			</StackPanel>

		</Grid>
	</Border>
</UserControl>

